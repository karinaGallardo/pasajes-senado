{{ define "descargo/create" }} {{ template "layout_start" . }}

<div class="max-w-4xl mx-auto">
  <div class="md:flex md:items-center md:justify-between mb-6">
    <div class="flex-1 min-w-0">
      <h2 class="text-2xl font-bold leading-7 text-neutral-900 sm:text-3xl sm:truncate">Realizar Descargo (FV-05)</h2>
      <p class="text-sm text-neutral-500 mt-1">Para Solicitud #{{ .Solicitud.ID }} - {{ .Solicitud.GetDestinoCiudad }}</p>
    </div>
    <div class="mt-4 flex md:mt-0 md:ml-4">
      <a
        href="/descargos/pv5?solicitud_id={{ .Solicitud.ID }}"
        class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-secondary hover:bg-primary transition-colors focus:outline-none ring-2 ring-offset-2 ring-secondary">
        <i class="ph ph-file-doc mr-2 text-lg"></i>
        Descargar Formulario PV5 Pre-llenado
      </a>
    </div>
  </div>

  <form action="/descargos" method="POST" class="bg-white shadow rounded-lg overflow-hidden border border-neutral-200">
    <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
    <input type="hidden" name="solicitud_id" value="{{ .Solicitud.ID }}" />

    <div class="p-6 space-y-6">
      <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
        <div class="sm:col-span-6 bg-primary-50 p-4 rounded-md border border-primary-100">
          <h4 class="text-sm font-bold text-primary mb-2">Resumen del Viaje</h4>
          <p class="text-sm text-primary">
            <strong>Motivo:</strong>
            {{ .Solicitud.Motivo }}
          </p>
          <p class="text-sm text-primary">
            <strong>Fechas:</strong>
            {{ if .Solicitud.GetFechaIda }}{{ .Solicitud.GetFechaIda.Format "02/01/2006" }}{{ else }} - {{ end }} - {{ if .Solicitud.GetFechaVuelta }}{{
            .Solicitud.GetFechaVuelta.Format "02/01/2006" }}{{ else }} - {{ end }}
          </p>
        </div>

        <div class="sm:col-span-3">
          <label class="block text-sm font-medium text-neutral-700">Fecha de Presentación</label>
          <div class="mt-1">
            <input
              type="date"
              name="fecha_presentacion"
              required
              class="shadow-sm focus:ring-secondary focus:border-secondary block w-full sm:text-sm border-neutral-300 rounded-md border p-2" />
          </div>
        </div>

        <div class="sm:col-span-3">
          <label class="block text-sm font-medium text-neutral-700">Monto Devolución (Bs)</label>
          <p class="text-xs text-neutral-500 mb-1">Si no utilizó algún pasaje o hubo saldo a favor.</p>
          <div class="mt-1">
            <input
              type="number"
              step="0.01"
              name="monto_devolucion"
              value="0.00"
              class="shadow-sm focus:ring-secondary focus:border-secondary block w-full sm:text-sm border-neutral-300 rounded-md border p-2" />
          </div>
        </div>

        <div class="sm:col-span-3">
          <label class="block text-sm font-medium text-neutral-700">Nº de Cite de Remisión</label>
          <div class="mt-1">
            <input
              type="text"
              name="numero_cite"
              class="shadow-sm focus:ring-secondary focus:border-secondary block w-full sm:text-sm border-neutral-300 rounded-md border p-2"
              placeholder="Ej: CITE-001/2025" />
          </div>
        </div>

        <div class="sm:col-span-6 bg-white border border-neutral-200 rounded p-4">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-sm font-bold text-neutral-700">Documentos de Respaldo (Facturas / Pases a Bordo)</h3>
            <button type="button" onclick="addDocRow()" class="text-xs bg-primary-50 text-primary-700 px-2 py-1 rounded border border-primary-200 hover:bg-primary-100">
              + Agregar Documento
            </button>
          </div>
          <div id="docs-container" class="space-y-2">
            <!-- Rows will be added here via JS -->
          </div>
        </div>

        <div class="sm:col-span-6">
          <label class="block text-sm font-medium text-neutral-700">Informe de Actividades</label>
          <div class="mt-1">
            <textarea
              name="informe_actividades"
              rows="5"
              required
              class="shadow-sm focus:ring-secondary focus:border-secondary block w-full sm:text-sm border border-neutral-300 rounded-md p-2"
              placeholder="Detalle las actividades realizadas durante el viaje..."></textarea>
          </div>
        </div>

        <div class="sm:col-span-6">
          <label class="block text-sm font-medium text-neutral-700">Observaciones</label>
          <div class="mt-1">
            <textarea
              name="observaciones"
              rows="2"
              class="shadow-sm focus:ring-secondary focus:border-secondary block w-full sm:text-sm border border-neutral-300 rounded-md p-2"></textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="px-4 py-3 bg-neutral-50 text-right sm:px-6 flex justify-end">
      <button
        type="submit"
        class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-800 focus:outline-none">
        Registrar Descargo
      </button>
    </div>
  </form>
</div>
<script>
  window.addDocRow = function () {
    const container = document.getElementById("docs-container");
    const row = document.createElement("div");
    row.className = "grid grid-cols-12 gap-2 items-center bg-neutral-50 p-2 rounded border border-neutral-100";
    row.innerHTML = `
            <div class="col-span-2">
                <select name="doc_tipo[]" class="w-full text-xs border-neutral-300 rounded">
                    <option value="FACTURA">Factura</option>
                    <option value="PASE_ABORDAJE">Pase Abordaje</option>
                    <option value="OTRO">Otro</option>
                </select>
            </div>
            <div class="col-span-2">
                <input type="date" name="doc_fecha[]" required class="w-full text-xs border-neutral-300 rounded">
            </div>
            <div class="col-span-3">
                <input type="text" name="doc_numero[]" required placeholder="Nº Doc" class="w-full text-xs border-neutral-300 rounded">
            </div>
            <div class="col-span-4">
                <input type="text" name="doc_detalle[]" placeholder="Detalle (Ej: Transporte)" class="w-full text-xs border-neutral-300 rounded">
            </div>
            <div class="col-span-1 text-right">
                <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-danger-500 hover:text-danger-700 font-bold">×</button>
            </div>
        `;
    container.appendChild(row);
  };
  document.addEventListener("DOMContentLoaded", window.addDocRow);
</script>

{{ template "layout_end" . }} {{ end }}
