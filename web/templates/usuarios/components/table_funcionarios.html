{{ define "usuarios/components/table_funcionarios" }}
<table class="min-w-full divide-y divide-gray-200">
  <thead class="bg-neutral-50">
    <tr>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-10">#</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Usuario / CI</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Nombre Completo</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Rol Sistema</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Cargo / Dependencia</th>
      <th scope="col" class="relative px-6 py-3"><span class="sr-only">Acciones</span></th>
    </tr>
  </thead>
  <tbody class="divide-y divide-gray-200 bg-white">
    {{ range $index, $user := .Usuarios }}
    <tr>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500 font-mono">
        {{ if $.Page }} {{ sum (sum (mul (sub $.Page 1) $.Limit) $index) 1 }} {{ else }} {{ inc $index }} {{ end }}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <div class="flex items-center">
          <div class="flex-shrink-0 h-10 w-10">
            <span class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-neutral-500">
              <span class="text-sm font-medium leading-none text-white">{{ printf "%.1s" $user.Username }}</span>
            </span>
          </div>
          <div class="ml-4">
            <div class="text-sm font-medium text-neutral-900">{{ $user.Username }}</div>
            <div class="text-sm text-neutral-500">{{ $user.CI }}</div>
          </div>
        </div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-sm text-neutral-900 font-bold uppercase">{{ $user.GetNombreCompleto }}</div>
        <div class="text-[11px] text-neutral-500">{{ if $user.Email }}{{ $user.Email }}{{ else }}-{{ end }}</div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        {{ if $user.Rol }}
        <span class="px-2 inline-flex text-xs leading-5 font-bold rounded-full bg-primary-100 text-primary-800">{{ $user.Rol.Codigo }}</span>
        {{ else }}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-neutral-100 text-neutral-800">Sin Rol</span>
        {{ end }}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        {{ if $user.Cargo }}
        <div class="text-sm text-neutral-900 font-medium">{{ $user.Cargo.Nombre }}</div>
        {{ else }}
        <span class="text-neutral-400 italic text-xs">No especificado</span>
        {{ end }}
        <div class="text-[10px] text-neutral-400 font-bold uppercase tracking-tighter">{{ $user.Tipo }}</div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        <!-- <a href="/solicitudes/nueva?user_id={{ $user.ID }}" class="text-primary hover:text-primary-800 font-bold inline-flex items-center mr-4">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
          </svg>
          Solicitar
        </a> -->
        <button
          x-data="{ loading: false }"
          @htmx:before-request="loading = true"
          @htmx:after-request="loading = false"
          class="text-primary hover:text-primary-900 font-bold disabled:opacity-50 inline-flex items-center"
          hx-get="/usuarios/{{ $user.ID }}/editar"
          hx-target="#modal-container"
          hx-disabled-elt="this">
          <span x-show="!loading">Editar</span>
          <span x-show="loading" class="inline-flex items-center" style="display: none">
            <svg class="animate-spin mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </span>
        </button>
      </td>
    </tr>
    {{ else }}
    <tr>
      <td colspan="6" class="px-6 py-20 text-center text-neutral-400 italic">No se encontraron funcionarios con el criterio de búsqueda.</td>
    </tr>
    {{ end }}
  </tbody>
</table>

{{ if .TotalPages }}
<div class="px-6 py-4 bg-neutral-50 border-t border-neutral-200 flex flex-col sm:flex-row items-center justify-between gap-4">
  <!-- Total count -->
  <div class="text-sm text-neutral-500">
    Mostrando
    <span class="font-bold text-neutral-900">{{ len .Usuarios }}</span>
    de
    <span class="font-bold text-neutral-900">{{ .Total }}</span>
    resultados {{ if .SearchTerm }} para "
    <span class="italic">{{ .SearchTerm }}</span>
    "{{ end }}
  </div>

  <!-- Pagination controls -->
  <div class="flex items-center space-x-2">
    {{ if gt .Page 1 }}
    <button
      hx-get="/usuarios/table?rol=FUNCIONARIO&page={{ sub .Page 1 }}&q={{ .SearchTerm }}"
      hx-target="#usuarios-table"
      hx-indicator="#table-loader"
      class="p-2 bg-white border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50 transition-colors shadow-sm"
      title="Anterior">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    {{ end }}

    <div class="px-4 py-1.5 bg-white border border-neutral-300 rounded-md text-sm font-bold text-neutral-700 shadow-sm">
      <span class="text-primary-600">Pág. {{ .Page }}</span>
      <span class="text-neutral-400 mx-1">/</span>
      {{ .TotalPages }}
    </div>

    {{ if lt .Page .TotalPages }}
    <button
      hx-get="/usuarios/table?rol=FUNCIONARIO&page={{ sum .Page 1 }}&q={{ .SearchTerm }}"
      hx-target="#usuarios-table"
      hx-indicator="#table-loader"
      class="p-2 bg-white border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50 transition-colors shadow-sm"
      title="Siguiente">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
    {{ end }}
  </div>
</div>
{{ end }} {{ end }}
