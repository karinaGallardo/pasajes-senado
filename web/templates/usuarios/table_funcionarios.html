{{ define "usuarios/table_funcionarios" }}
<table class="min-w-full divide-y divide-gray-200">
  <thead class="bg-gray-50">
    <tr>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">#</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario / CI</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre Completo</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol Sistema</th>
      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cargo / Dependencia</th>
      <th scope="col" class="relative px-6 py-3"><span class="sr-only">Acciones</span></th>
    </tr>
  </thead>
  <tbody class="divide-y divide-gray-200 bg-white">
    {{ range $index, $user := .Usuarios }}
    <tr>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">
        {{ if $.Page }} {{ sum (sum (mul (sub $.Page 1) $.Limit) $index) 1 }} {{ else }} {{ inc $index }} {{ end }}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <div class="flex items-center">
          <div class="flex-shrink-0 h-10 w-10">
            <span class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-gray-500">
              <span class="text-sm font-medium leading-none text-white">{{ printf "%.1s" $user.Username }}</span>
            </span>
          </div>
          <div class="ml-4">
            <div class="text-sm font-medium text-gray-900">{{ $user.Username }}</div>
            <div class="text-sm text-gray-500">{{ $user.CI }}</div>
          </div>
        </div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-sm text-gray-900 font-bold uppercase">{{ $user.GetNombreCompleto }}</div>
        <div class="text-[11px] text-gray-500">{{ if $user.Email }}{{ $user.Email }}{{ else }}-{{ end }}</div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        {{ if $user.Rol }}
        <span class="px-2 inline-flex text-xs leading-5 font-bold rounded-full bg-blue-100 text-blue-800">{{ $user.Rol.Codigo }}</span>
        {{ else }}
        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Sin Rol</span>
        {{ end }}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        {{ if $user.Cargo }}
        <div class="text-sm text-gray-900 font-medium">{{ $user.Cargo.Nombre }}</div>
        {{ else }}
        <span class="text-gray-400 italic text-xs">No especificado</span>
        {{ end }}
        <div class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter">{{ $user.Tipo }}</div>
      </td>
      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">{{ template "usuarios/actions" $user }}</td>
    </tr>
    {{ else }}
    <tr>
      <td colspan="6" class="px-6 py-20 text-center text-gray-400 italic">No se encontraron funcionarios con el criterio de búsqueda.</td>
    </tr>
    {{ end }}
  </tbody>
</table>

{{ if .TotalPages }}
<div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
  <!-- Total count -->
  <div class="text-sm text-gray-500">
    Mostrando
    <span class="font-bold text-gray-900">{{ len .Usuarios }}</span>
    de
    <span class="font-bold text-gray-900">{{ .Total }}</span>
    resultados {{ if .SearchTerm }} para "
    <span class="italic">{{ .SearchTerm }}</span>
    "{{ end }}
  </div>

  <!-- Pagination controls -->
  <div class="flex items-center space-x-2">
    {{ if gt .Page 1 }}
    <button
      hx-get="/usuarios/table?rol=FUNCIONARIO&page={{ sub .Page 1 }}&q={{ .SearchTerm }}"
      hx-target="#usuarios-table"
      hx-indicator="#table-loader"
      class="p-2 bg-white border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors shadow-sm"
      title="Anterior"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    {{ end }}

    <div class="px-4 py-1.5 bg-white border border-gray-300 rounded-md text-sm font-bold text-gray-700 shadow-sm">
      <span class="text-indigo-600">Pág. {{ .Page }}</span>
      <span class="text-gray-400 mx-1">/</span>
      {{ .TotalPages }}
    </div>

    {{ if lt .Page .TotalPages }}
    <button
      hx-get="/usuarios/table?rol=FUNCIONARIO&page={{ add .Page 1 }}&q={{ .SearchTerm }}"
      hx-target="#usuarios-table"
      hx-indicator="#table-loader"
      class="p-2 bg-white border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors shadow-sm"
      title="Siguiente"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
    {{ end }}
  </div>
</div>
{{ end }} {{ end }}
