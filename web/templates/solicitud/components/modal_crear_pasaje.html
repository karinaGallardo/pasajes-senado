{{ define "solicitud/components/modal_crear_pasaje" }}
<div x-data="{ open: true }" x-show="open" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true" style="display: none">
  <div
    x-show="open"
    x-transition:enter="ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-neutral-500 bg-opacity-75 transition-opacity"></div>

  <div class="fixed inset-0 z-10 overflow-y-auto">
    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
      <div
        x-show="open"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <h3 class="text-lg leading-6 font-medium text-neutral-900 mb-4" id="modal-title">Asignar Nuevo Pasaje</h3>

          <form action="/solicitudes/{{ .Solicitud.ID }}/pasajes" method="POST" enctype="multipart/form-data" x-data="{ loading: false, fileName: '' }" @submit="loading = true">
            <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
            <div class="grid grid-cols-6 gap-6">
              <div class="col-span-6 text-center bg-primary-50 p-2 rounded-md border border-primary-100">
                <span class="block text-xs font-bold text-primary-600 uppercase tracking-widest">Asignando Pasaje a:</span>
                <span class="block text-lg font-black text-neutral-800">{{ .Solicitud.Usuario.GetNombreCompleto }}</span>
              </div>

              <div
                class="col-span-6"
                x-data="searchableSelect({
                    items: [
                        {{ range .Rutas }}
                        { id: '{{ .Tramo }}', name: '{{ .Tramo }}' },
                        {{ end }}
                    ],
                    initialId: '{{ .Solicitud.Origen.Ciudad }} - {{ .Solicitud.Destino.Ciudad }}',
                    initialName: '{{ .Solicitud.Origen.Ciudad }} - {{ .Solicitud.Destino.Ciudad }}'
                })">
                <label class="block text-sm font-medium text-neutral-700">Ruta (Origen - Destino)</label>
                <div class="relative mt-1">
                  <input type="hidden" name="ruta" :value="selectedId" />

                  <div class="relative">
                    <div
                      @click="open = true; $nextTick(() => $refs.searchInput.focus())"
                      x-show="!open"
                      class="w-full rounded-md border border-neutral-300 bg-white py-2 pl-3 pr-10 shadow-sm focus:border-secondary focus:outline-none focus:ring-1 focus:ring-secondary sm:text-sm cursor-pointer flex items-center justify-between min-h-[38px]">
                      <span x-text="selectedName || 'Seleccione una ruta'"></span>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-neutral-400" viewBox="0 0 20 20" fill="currentColor">
                        <path
                          fill-rule="evenodd"
                          d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                          clip-rule="evenodd" />
                      </svg>
                    </div>

                    <input
                      x-ref="searchInput"
                      type="text"
                      x-model="search"
                      x-show="open"
                      @click.away="open = false"
                      @keydown.escape="open = false"
                      @keydown.enter.prevent="if (filteredItems.length > 0) select(filteredItems[0])"
                      placeholder="Buscar ruta..."
                      class="w-full rounded-md border border-secondary bg-white py-2 pl-3 pr-10 shadow-sm focus:outline-none focus:ring-1 focus:ring-secondary sm:text-sm" />

                    <ul
                      x-show="open"
                      class="absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"
                      x-cloak>
                      <template x-for="item in filteredItems" :key="item.id">
                        <li class="relative cursor-default select-none py-2 pl-3 pr-9 text-neutral-900 hover:bg-primary hover:text-white" @click="select(item)">
                          <span class="block truncate" x-text="item.name"></span>
                        </li>
                      </template>
                      <li x-show="filteredItems.length === 0" class="relative cursor-default select-none py-2 pl-3 pr-9 text-neutral-500">Sin resultados.</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Agencia Emisora</label>
                <select
                  name="agencia_id"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2">
                  <option value="">-- Seleccionar --</option>
                  {{ range .Agencias }}
                  <option value="{{ .ID }}">{{ .Nombre }}</option>
                  {{ end }}
                </select>
              </div>

              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Aerolínea</label>
                <select
                  name="aerolinea_id"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2">
                  <option value="">-- Seleccionar --</option>
                  {{ range .Aerolineas }}
                  <option value="{{ .ID }}">{{ .Nombre }}</option>
                  {{ end }}
                </select>
              </div>
              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Nº Vuelo</label>
                <input
                  type="text"
                  name="numero_vuelo"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2"
                  placeholder="Ej: OB-123" />
              </div>

              <div class="col-span-6 sm:col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Fecha y Hora Vuelo</label>
                <input
                  type="datetime-local"
                  name="fecha_vuelo"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2" />
              </div>

              <div class="col-span-6 sm:col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Código Reserva (PNR)</label>
                <input
                  type="text"
                  name="codigo_reserva"
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2"
                  placeholder="Ej: X7Y8Z9" />
              </div>

              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Nº Boleto</label>
                <input
                  type="text"
                  name="numero_boleto"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2"
                  placeholder="Ej: 93021..." />
              </div>

              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Nº Factura / Recibo</label>
                <input
                  type="text"
                  name="numero_factura"
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2"
                  placeholder="Ej: 45678" />
              </div>

              <div class="col-span-3">
                <label class="block text-sm font-medium text-neutral-700">Costo (Bs)</label>
                <input
                  type="number"
                  step="0.01"
                  name="costo"
                  required
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2" />
              </div>

              <div class="col-span-6">
                <label class="block text-sm font-medium text-neutral-700">Observaciones / Glosa (Opcional)</label>
                <textarea
                  name="glosa"
                  rows="2"
                  class="mt-1 focus:ring-secondary focus:border-secondary block w-full shadow-sm sm:text-sm border-neutral-300 rounded-md border p-2"
                  placeholder="Detalles adicionales..."></textarea>
              </div>

              <div class="col-span-6 border-t border-neutral-100 pt-4">
                <label class="block text-sm font-medium text-neutral-700 mb-2">Billete Electrónico (PDF)</label>
                <div
                  class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-neutral-300 border-dashed rounded-md bg-white hover:bg-neutral-50 transition-colors cursor-pointer relative group">
                  <input
                    type="file"
                    name="archivo"
                    accept=".pdf"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                    @change="fileName = $event.target.files[0].name"
                    required />

                  <div class="space-y-1 text-center" x-show="!fileName">
                    <svg class="mx-auto h-12 w-12 text-neutral-400 group-hover:text-neutral-500 transition-colors" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                      <path
                        d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round" />
                    </svg>
                    <div class="flex text-sm text-neutral-600 justify-center">
                      <span class="font-bold text-secondary group-hover:underline">Cargar Ticket</span>
                      <p class="pl-1">o arrastrar aquí</p>
                    </div>
                    <p class="text-xs text-neutral-500">Solo archivos PDF</p>
                  </div>

                  <div class="space-y-1 text-center" x-show="fileName" x-cloak>
                    <div class="mx-auto h-12 w-12 bg-danger-100 rounded-full flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-danger-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                    </div>
                    <p class="text-sm font-bold text-neutral-900 truncate px-4" x-text="fileName"></p>
                    <p class="text-xs text-success-600 font-medium">✓ Listo para subir</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-neutral-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
              <button
                type="submit"
                :disabled="loading"
                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary text-base font-medium text-white hover:bg-primary-800 focus:outline-none disabled:opacity-50 sm:ml-3 sm:w-auto sm:text-sm">
                <span x-show="!loading">Crear Pasaje</span>
                <span x-show="loading">Guardando...</span>
              </button>
              <button
                type="button"
                @click="open = false"
                class="mt-3 w-full inline-flex justify-center rounded-md border border-neutral-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-neutral-700 hover:bg-neutral-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{{ end }}
